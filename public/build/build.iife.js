(function(e){"use strict";const b=(s,o)=>{const n=s.__vccOpts||s;for(const[c,t]of o)n[c]=t;return n},w={class:"codecheck-manifest-files"},D={class:"manifest-files-list"},B=["onUpdate:modelValue"],S=["onUpdate:modelValue"],C=["onClick"],E=b({__name:"CodecheckManifestFiles",props:{name:{type:String,required:!0},label:{type:String,required:!0},description:{type:String,default:""},value:{type:String,default:""},isRequired:{type:Boolean,default:!1}},setup(s){const o=s,n=e.ref([]);e.onMounted(()=>{o.value&&o.value.split(`
`).forEach(i=>{if(i.trim()){const r=i.split(" - ");n.value.push({filename:r[0]||"",comment:r[1]||""})}}),n.value.length===0&&c()});function c(){n.value.push({filename:"",comment:""})}function t(i){n.value.splice(i,1),a()}function a(){var l;const i=n.value.filter(m=>m.filename.trim()).map(m=>m.filename+(m.comment?" - "+m.comment:"")),r=new CustomEvent("update",{detail:i.join(`
`)});(l=document.querySelector(`[data-name="${o.name}"]`))==null||l.dispatchEvent(r)}return(i,r)=>(e.openBlock(),e.createElementBlock("div",w,[e.createElementVNode("div",D,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,(l,m)=>(e.openBlock(),e.createElementBlock("div",{key:m,class:"manifest-file-row"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":k=>l.filename=k,type:"text",placeholder:"Filename (e.g., figures/figure1.png)",onInput:a,class:"form-control"},null,40,B),[[e.vModelText,l.filename]]),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":k=>l.comment=k,type:"text",placeholder:"Comment (e.g., Main result visualization)",onInput:a,class:"form-control"},null,40,S),[[e.vModelText,l.comment]]),e.createElementVNode("button",{type:"button",onClick:k=>t(m),class:"btn-remove"},"Remove",8,C)]))),128))]),e.createElementVNode("button",{type:"button",onClick:c,class:"btn-add"},"+ Add File")]))}},[["__scopeId","data-v-e8d2b036"]]),M={class:"codecheck-repository-list"},T={class:"repository-list"},U=["onUpdate:modelValue"],F=["onClick"],_=b({__name:"CodecheckRepositoryList",props:{name:{type:String,required:!0},label:{type:String,required:!0},description:{type:String,default:""},value:{type:String,default:""}},setup(s){const o=s,n=e.ref([]);e.onMounted(()=>{o.value&&o.value.split(`
`).forEach(i=>{i.trim()&&n.value.push(i.trim())}),n.value.length===0&&c()});function c(){n.value.push("")}function t(i){n.value.splice(i,1),a()}function a(){var l;const i=n.value.filter(m=>m.trim()).join(`
`),r=new CustomEvent("update",{detail:i});(l=document.querySelector(`[data-name="${o.name}"]`))==null||l.dispatchEvent(r)}return(i,r)=>(e.openBlock(),e.createElementBlock("div",M,[e.createElementVNode("div",T,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,(l,m)=>(e.openBlock(),e.createElementBlock("div",{key:m,class:"repository-row"},[e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":k=>n.value[m]=k,type:"text",placeholder:"Repository URL (e.g., https://github.com/username/repo)",onInput:a,class:"form-control"},null,40,U),[[e.vModelText,n.value[m]]]),e.createElementVNode("button",{type:"button",onClick:k=>t(m),class:"btn-remove"},"Remove",8,F)]))),128))]),e.createElementVNode("button",{type:"button",onClick:c,class:"btn-add"},"+ Add Repository")]))}},[["__scopeId","data-v-e9d9bb23"]]),I={class:"codecheck-review-display"},x={key:0,class:"codecheck-info"},R={class:"info-section"},L={key:0,class:"info-section"},O={key:1,class:"info-section"},A={key:2,class:"info-section"},P={key:3,class:"info-section"},j={key:0},q={key:4,class:"info-section"},z={key:0,class:"orcid-badge"},H={key:5,class:"info-section"},Y=["href"],W={key:6,class:"info-section"},K={key:7,class:"info-section"},X={key:8,class:"info-section"},J=["href"],G={class:"actions"},Q={key:1,class:"codecheck-not-opted"},Z=b({__name:"CodecheckReviewDisplay",props:{submission:{type:Object,required:!0}},setup(s){const{useLocalize:o}=pkp.modules.useLocalize,{t:n}=o(),c=s,t=e.computed(()=>{if(c.submission.codecheckMetadata){if(typeof c.submission.codecheckMetadata=="string")try{return JSON.parse(c.submission.codecheckMetadata)}catch(f){return console.error("Failed to parse codecheck metadata:",f),{}}return c.submission.codecheckMetadata}return{}}),a=e.computed(()=>Object.keys(t.value).length>0);function i(){return t.value.certificate&&t.value.checkTime?"complete":a.value?"in-progress":"pending"}const r=e.computed(()=>{switch(i()){case"complete":return"status-complete";case"in-progress":return"status-in-progress";case"pending":default:return"status-pending"}});function l(){switch(i()){case"complete":return n("plugins.generic.codecheck.status.complete");case"in-progress":return n("plugins.generic.codecheck.status.inProgress");case"pending":default:return n("plugins.generic.codecheck.status.pending")}}function m(f){return f?new Date(f).toLocaleString():""}function k(){const f=pkp.registry.getPiniaStore("workflow");f.selectedMenuState={primaryMenuItem:"workflow",stageId:999}}return(f,d)=>{var u;const y=e.resolveComponent("pkp-button");return e.openBlock(),e.createElementBlock("div",I,[e.createElementVNode("h3",null,e.toDisplayString(e.unref(n)("plugins.generic.codecheck.reviewTitle")),1),(u=s.submission)!=null&&u.codecheckOptIn?(e.openBlock(),e.createElementBlock("div",x,[e.createElementVNode("div",R,[e.createElementVNode("h4",null,e.toDisplayString(e.unref(n)("plugins.generic.codecheck.status")),1),e.createElementVNode("span",{class:e.normalizeClass(["status-badge",r.value])},e.toDisplayString(l()),3)]),a.value&&t.value.configVersion?(e.openBlock(),e.createElementBlock("div",L,[e.createElementVNode("h4",null,e.toDisplayString(e.unref(n)("plugins.generic.codecheck.review.configVersion")),1),e.createElementVNode("p",null,e.toDisplayString(t.value.configVersion),1)])):e.createCommentVNode("",!0),a.value&&t.value.publicationType?(e.openBlock(),e.createElementBlock("div",O,[e.createElementVNode("h4",null,e.toDisplayString(e.unref(n)("plugins.generic.codecheck.review.publicationType")),1),e.createElementVNode("p",null,e.toDisplayString(t.value.publicationType==="doi"?e.unref(n)("plugins.generic.codecheck.review.publicationType.doi"):e.unref(n)("plugins.generic.codecheck.review.publicationType.separate")),1)])):e.createCommentVNode("",!0),a.value&&t.value.certificate?(e.openBlock(),e.createElementBlock("div",A,[e.createElementVNode("h4",null,e.toDisplayString(e.unref(n)("plugins.generic.codecheck.identifier.label")),1),e.createElementVNode("p",null,e.toDisplayString(t.value.certificate),1)])):e.createCommentVNode("",!0),a.value&&t.value.manifest&&t.value.manifest.length>0?(e.openBlock(),e.createElementBlock("div",P,[e.createElementVNode("h4",null,e.toDisplayString(e.unref(n)("plugins.generic.codecheck.review.manifestFiles")),1),e.createElementVNode("ul",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.value.manifest,(h,p)=>(e.openBlock(),e.createElementBlock("li",{key:p},[e.createElementVNode("strong",null,e.toDisplayString(h.file),1),h.comment?(e.openBlock(),e.createElementBlock("span",j," - "+e.toDisplayString(h.comment),1)):e.createCommentVNode("",!0)]))),128))])])):e.createCommentVNode("",!0),a.value&&t.value.codecheckers&&t.value.codecheckers.length>0?(e.openBlock(),e.createElementBlock("div",q,[e.createElementVNode("h4",null,e.toDisplayString(e.unref(n)("plugins.generic.codecheck.review.codecheckers")),1),e.createElementVNode("ul",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.value.codecheckers,(h,p)=>(e.openBlock(),e.createElementBlock("li",{key:p},[e.createTextVNode(e.toDisplayString(h.name)+" ",1),h.orcid?(e.openBlock(),e.createElementBlock("span",z,e.toDisplayString(h.orcid),1)):e.createCommentVNode("",!0)]))),128))])])):e.createCommentVNode("",!0),a.value&&t.value.repository?(e.openBlock(),e.createElementBlock("div",H,[e.createElementVNode("h4",null,e.toDisplayString(e.unref(n)("plugins.generic.codecheck.repositories.title")),1),e.createElementVNode("a",{href:t.value.repository,target:"_blank"},e.toDisplayString(t.value.repository),9,Y)])):e.createCommentVNode("",!0),a.value&&t.value.checkTime?(e.openBlock(),e.createElementBlock("div",W,[e.createElementVNode("h4",null,e.toDisplayString(e.unref(n)("plugins.generic.codecheck.completionTime.label")),1),e.createElementVNode("p",null,e.toDisplayString(m(t.value.checkTime)),1)])):e.createCommentVNode("",!0),a.value&&t.value.summary?(e.openBlock(),e.createElementBlock("div",K,[e.createElementVNode("h4",null,e.toDisplayString(e.unref(n)("plugins.generic.codecheck.certificate.summary")),1),e.createElementVNode("p",null,e.toDisplayString(t.value.summary),1)])):e.createCommentVNode("",!0),a.value&&t.value.reportUrl?(e.openBlock(),e.createElementBlock("div",X,[e.createElementVNode("h4",null,e.toDisplayString(e.unref(n)("plugins.generic.codecheck.review.reportUrl")),1),e.createElementVNode("a",{href:t.value.reportUrl,target:"_blank"},e.toDisplayString(t.value.reportUrl),9,J)])):e.createCommentVNode("",!0),e.createElementVNode("div",G,[e.createVNode(y,{onClick:k},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(n)("plugins.generic.codecheck.viewFullMetadata")),1)]),_:1})])])):(e.openBlock(),e.createElementBlock("div",Q,[e.createElementVNode("p",null,e.toDisplayString(e.unref(n)("plugins.generic.codecheck.notOptedIn")),1)]))])}}},[["__scopeId","data-v-2ac9f582"]]),{useLocalize:$}=pkp.modules.useLocalize,v={name:"CodecheckMetadataForm",props:{submission:{type:Object,required:!0},canEdit:{type:Boolean,default:!0},name:{type:String},value:{type:String}},setup(){const{t:s}=$();return{t:s}},data(){return{loading:!0,saving:!1,dataLoaded:!1,error:null,saveMessage:"",saveMessageType:"",repositories:[],submissionData:{id:null,title:"",authors:[],doi:"",codeRepository:"",dataRepository:"",manifestFiles:"",dataAvailabilityStatement:""},certificateIdentifier:{venueType:"default",venueName:"default",venueTypes:[],venueNames:[],issueUrl:""},metadata:{configVersion:"latest",publicationType:"doi",manifest:[],repository:"",codecheckers:[],certificate:"",checkTime:"",summary:"",reportUrl:""}}},computed:{canPreview(){return this.metadata.manifest.length>0&&this.metadata.codecheckers.length>0&&this.metadata.certificate},isIdentifierReserved(){return this.metadata.certificate.trim()!==""}},mounted(){this.loadData(),this.getVenueData()},methods:{async loadData(){var s,o,n,c,t,a,i,r;this.loading=!0,this.error=null,this.dataLoaded=!1;try{if(!this.submission||!this.submission.id)throw new Error("Invalid submission object");const l=this.submission.id;let m=pkp.context.apiBaseUrl.replace(/\/api\/v1\/?$/,"");m+="/codecheck";const k=`${m}/metadata?submissionId=${l}`,f=await fetch(k,{headers:{"X-Csrf-Token":pkp.currentUser.csrfToken}});if(!f.ok)throw new Error(`HTTP ${f.status}: ${f.statusText}`);const d=await f.json();this.submissionData={id:((s=d.submission)==null?void 0:s.id)||l,title:((o=d.submission)==null?void 0:o.title)||"",authors:Array.isArray((n=d.submission)==null?void 0:n.authors)?d.submission.authors:[],doi:((c=d.submission)==null?void 0:c.doi)||"",codeRepository:((t=d.submission)==null?void 0:t.codeRepository)||"",dataRepository:((a=d.submission)==null?void 0:a.dataRepository)||"",manifestFiles:((i=d.submission)==null?void 0:i.manifestFiles)||"",dataAvailabilityStatement:((r=d.submission)==null?void 0:r.dataAvailabilityStatement)||""},d.codecheck&&typeof d.codecheck=="object"&&(this.metadata={configVersion:d.codecheck.configVersion||d.codecheck.config_version||"latest",publicationType:d.codecheck.publicationType||d.codecheck.publication_type||"doi",manifest:Array.isArray(d.codecheck.manifest)?d.codecheck.manifest:typeof d.codecheck.manifest=="string"?JSON.parse(d.codecheck.manifest):[],repository:d.codecheck.repository||"",codecheckers:Array.isArray(d.codecheck.codecheckers)?d.codecheck.codecheckers:typeof d.codecheck.codecheckers=="string"?JSON.parse(d.codecheck.codecheckers):[],certificate:d.codecheck.certificate||"",checkTime:d.codecheck.checkTime||d.codecheck.check_time?this.formatDateTimeLocal(d.codecheck.checkTime||d.codecheck.check_time):"",summary:d.codecheck.summary||"",reportUrl:d.codecheck.reportUrl||d.codecheck.report_url||""},d.codecheck.repository&&(this.repositories=d.codecheck.repository.split(",").map(y=>y.trim()).filter(y=>y))),this.dataLoaded=!0}catch(l){console.error("Load error:",l),this.error=this.t("plugins.generic.codecheck.loadError")+": "+l.message}finally{this.loading=!1}},triggerFileUpload(){this.$refs.fileInput.click()},async handleFileUpload(s){const o=s.target.files;if(!(!o||o.length===0)){this.saving=!0,this.saveMessage=this.t("plugins.generic.codecheck.uploadingFiles");for(let n=0;n<o.length;n++){const c=o[n];try{const t=await this.uploadFile(c);t.success?this.metadata.manifest.push({file:t.filename,size:t.size,filePath:t.filePath,comment:"",checked:!1}):this.showMessage("Failed to upload: "+c.name,"error")}catch(t){console.error("Upload error:",t),this.showMessage("Failed to upload: "+c.name,"error")}}s.target.value="",this.saving=!1,this.saveMessage=""}},async uploadFile(s){const o=new FormData;o.append("file",s),o.append("submissionId",this.submission.id);let n=pkp.context.apiBaseUrl.replace(/\/api\/v1\/?$/,"");n+="/codecheck";const c=`${n}/upload`,t=await fetch(c,{method:"POST",headers:{"X-Csrf-Token":pkp.currentUser.csrfToken},body:o});if(!t.ok)throw new Error("Upload failed");return await t.json()},downloadFile(s,o){if(!s){alert("File path not available");return}let n=pkp.context.apiBaseUrl.replace(/\/api\/v1\/?$/,"");n+="/codecheck";const c=`${n}/download?file=${encodeURIComponent(s)}`;window.open(c,"_blank")},formatFileSize(s){if(s===0)return"0 Bytes";const o=1024,n=["Bytes","KB","MB","GB"],c=Math.floor(Math.log(s)/Math.log(o));return parseFloat((s/Math.pow(o,c)).toFixed(2))+" "+n[c]},removeManifestFile(s){confirm(this.t("plugins.generic.codecheck.manifest.removeConfirm"))&&this.metadata.manifest.splice(s,1)},addRepository(){this.repositories.push("")},removeRepository(s){confirm(this.t("plugins.generic.codecheck.repositories.removeConfirm"))&&this.repositories.splice(s,1)},showCodecheckerModal(){this.canUsePkpModal()?this.showPkpCodecheckerModal():this.showFallbackCodecheckerModal()},canUsePkpModal(){return typeof pkp<"u"&&pkp.modules&&pkp.modules.useModal},showPkpCodecheckerModal(){const{useModal:s}=pkp.modules.useModal,{openDialog:o}=s(),n='<div class="modal-form"><div class="modal-field"><label for="checker-name" class="modal-label">'+this.t("plugins.generic.codecheck.codecheckers.enterName")+'</label><input type="text" id="checker-name" class="modal-input" placeholder="'+this.t("plugins.generic.codecheck.codecheckers.enterName")+'" /></div><div class="modal-field"><label for="checker-orcid" class="modal-label">'+this.t("plugins.generic.codecheck.codecheckers.enterOrcid")+'</label><input type="text" id="checker-orcid" class="modal-input" placeholder="0000-0000-0000-0000" /></div></div>';o({title:this.t("plugins.generic.codecheck.codecheckers.addCodechecker"),message:n,actions:[{label:this.t("plugins.generic.codecheck.modal.cancel"),callback:c=>c()},{label:this.t("plugins.generic.codecheck.modal.add"),isPrimary:!0,callback:c=>{const t=document.getElementById("checker-name"),a=document.getElementById("checker-orcid"),i=(t==null?void 0:t.value)||"",r=(a==null?void 0:a.value)||"";i.trim()&&this.metadata.codecheckers.push({name:i.trim(),orcid:r.trim()}),c()}}]})},showFallbackCodecheckerModal(){const s=prompt(this.t("plugins.generic.codecheck.codecheckers.enterName"));if(s&&s.trim()){const o=prompt(this.t("plugins.generic.codecheck.codecheckers.enterOrcid"));this.metadata.codecheckers.push({name:s.trim(),orcid:o?o.trim():""})}},removeCodechecker(s){confirm(this.t("plugins.generic.codecheck.codecheckers.removeConfirm"))&&this.metadata.codecheckers.splice(s,1)},async saveMetadata(){if(this.validateForm()){this.saving=!0,this.saveMessage="";try{const s={config_version:this.metadata.configVersion,publication_type:this.metadata.publicationType,manifest:this.metadata.manifest,repository:this.repositories.join(", "),codecheckers:this.metadata.codecheckers,certificate:this.metadata.certificate,check_time:this.metadata.checkTime,summary:this.metadata.summary,report_url:this.metadata.reportUrl};console.log("Saving CODECHECK data:",s);const o=this.submission.id;let n=pkp.context.apiBaseUrl.replace(/\/api\/v1\/?$/,"");n+="/codecheck";const c=`${n}/metadata?submissionId=${o}`;if(!(await fetch(c,{method:"POST",headers:{"Content-Type":"application/json","X-Csrf-Token":pkp.currentUser.csrfToken},body:JSON.stringify(s)})).ok)throw new Error("Failed to save");this.showMessage(this.t("plugins.generic.codecheck.savedSuccessfully"),"success")}catch(s){console.error("Save error:",s),this.showMessage(this.t("plugins.generic.codecheck.saveFailed"),"error")}finally{this.saving=!1}}},async previewYaml(){try{const s=this.generateYamlContent();this.canUsePkpModal()?this.showYamlModal(s):this.showYamlFallback(s)}catch{this.showMessage(this.t("plugins.generic.codecheck.yamlPreviewFailed"),"error")}},generateYamlContent(){const s=[];return s.push("---"),s.push("version: https://codecheck.org.uk/spec/config/"+this.metadata.configVersion+"/"),s.push("paper:"),s.push('  title: "'+(this.submissionData.title||"Untitled")+'"'),s.push("  authors:"),this.submissionData.authors&&this.submissionData.authors.length>0&&this.submissionData.authors.forEach(o=>{s.push("    - name: "+o.name),o.orcid&&s.push("      ORCID: "+o.orcid)}),this.submissionData.doi&&s.push("  reference: https://doi.org/"+this.submissionData.doi),s.push("manifest:"),this.metadata.manifest&&this.metadata.manifest.length>0&&this.metadata.manifest.forEach(o=>{s.push("  - file: "+o.file),o.comment&&s.push('    comment: "'+o.comment+'"')}),s.push("codechecker:"),this.metadata.codecheckers&&this.metadata.codecheckers.length>0&&this.metadata.codecheckers.forEach(o=>{s.push("  - name: "+o.name),o.orcid&&s.push("    ORCID: "+o.orcid)}),this.metadata.summary&&(s.push("summary: >"),this.metadata.summary.split(`
`).forEach(n=>{s.push("  "+n)})),this.repositories.length>0&&s.push("repository: "+this.repositories[0]),this.metadata.checkTime&&s.push('check_time: "'+this.metadata.checkTime+'"'),this.metadata.certificate&&s.push("certificate: "+this.metadata.certificate),this.metadata.reportUrl&&s.push("report: "+this.metadata.reportUrl),s.join(`
`)},showYamlModal(s){const{useModal:o}=pkp.modules.useModal,{openDialog:n}=o(),c="downloadCodecheckYaml_"+Date.now();window[c]=function(){const a=new Blob([s],{type:"text/yaml"}),i=URL.createObjectURL(a),r=document.createElement("a");r.href=i,r.download="codecheck.yml",r.click(),URL.revokeObjectURL(i)};const t='<div class="yaml-modal-container"><pre class="yaml-preview-content">'+this.escapeHtml(s)+"</pre></div>";n({title:this.t("plugins.generic.codecheck.yaml.previewTitle"),message:t,actions:[{label:this.t("plugins.generic.codecheck.yaml.download"),isPrimary:!0,callback:a=>{window[c](),delete window[c],a()}},{label:this.t("plugins.generic.codecheck.yaml.close"),callback:a=>{delete window[c],a()}}]})},showYamlFallback(s){const o=window.open("","_blank"),n=this.escapeHtml(s),c=JSON.stringify(s),t='<!DOCTYPE html><html><head><title>CODECHECK Metadata Preview</title><style>body { font-family: "Courier New", monospace; padding: 20px; background: #f5f5f5; }.container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }h2 { color: #007ab2; margin-top: 0; }pre { background: #2d2d2d; color: #f8f8f2; padding: 20px; border-radius: 4px; overflow-x: auto; line-height: 1.6; }.actions { margin-top: 20px; display: flex; gap: 10px; }button { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 14px; }.download-btn { background: #007ab2; color: white; }.download-btn:hover { background: #005a87; }.close-btn { background: #dc3545; color: white; }.close-btn:hover { background: #c82333; }</style></head><body><div class="container"><h2>ðŸ“„ CODECHECK Metadata Preview</h2><pre>'+n+"</pre></div><script>function downloadYaml() {  const blob = new Blob(["+c+'], { type: "text/yaml" });  const url = URL.createObjectURL(blob);  const a = document.createElement("a");  a.href = url;  a.download = "codecheck.yml";  a.click();  URL.revokeObjectURL(url);}<\\/script></body></html>';o.document.write(t)},async getVenueData(){let s=pkp.context.apiBaseUrl.replace(/\/api\/v1\/?$/,"");s+="/codecheck_api";try{const n=await(await fetch(`${s}/getVenueData`,{method:"POST",headers:{"Content-Type":"application/json","X-Csrf-Token":pkp.currentUser.csrfToken}})).json();n.success?(console.log("Success:",n.message),this.certificateIdentifier.venueTypes=n.venueTypes,this.certificateIdentifier.venueNames=n.venueNames,console.log("Venue types:",this.certificateIdentifier.venueTypes),console.log("Venue names:",this.certificateIdentifier.venueNames)):console.error("Error:",n.error)}catch(o){console.error("Failed to fetch venue data:",o)}},async reserveIdentifier(){if(this.certificateIdentifier.venueType==="default"||this.certificateIdentifier.venueName==="default"){alert("Please select both a Venue Type and a Venue Name.");return}const s=this.submissionData.authors.length>1?this.submissionData.authors[0].name+" et al.":this.submissionData.authors[0].name;console.log(s);let o=pkp.context.apiBaseUrl.replace(/\/api\/v1\/?$/,"");o+="/codecheck_api";try{const c=await(await fetch(`${o}/reserveIdentifier`,{method:"POST",headers:{"Content-Type":"application/json","X-Csrf-Token":pkp.currentUser.csrfToken},body:JSON.stringify({venueType:this.certificateIdentifier.venueType,venueName:this.certificateIdentifier.venueName,authorString:s})})).json();c.success?(this.metadata.certificate=c.identifier,this.certificateIdentifier.issueUrl=c.issueUrl,this.$emit("update",this.metadata.certificate),alert(`New identifier reserved: ${c.identifier}`),console.log("New identifier reserved: ",c.identifier,c.issueUrl)):console.error("Error:",c.error)}catch(n){console.error("Request failed:",n)}},removeIdentifier(s){this.metadata.certificate="",this.certificateIdentifier.issueUrl="",this.$emit("update",this.metadata.certificate),s()},showRemoveIdentifierModal(){if(!this.canUsePkpModal()){this.fallbackCertificateIdentifierModal();return}const{useModal:s}=pkp.modules.useModal,{openDialog:o}=s();o({title:"Remove Certificate Identifier",message:`
          <div class="modal-form">
            <div class="modal-field">
              <label for="repo-url" class="modal-label">Are you sure you want to remove this identifier?</label>
            </div>
          </div>
        `,actions:[{label:"No",callback:n=>n()},{label:"Yes",isPrimary:!0,callback:n=>{this.removeIdentifier(n)}}]})},fallbackCertificateIdentifierModal(){confirm("Are you sure you want to remove this identifier?")&&(this.metadata.certificate="",this.certificateIdentifier.issueUrl="",this.$emit("update",this.metadata.certificate))},escapeHtml(s){const o=document.createElement("div");return o.textContent=s,o.innerHTML},validateForm(){return this.metadata.manifest.length===0?(this.showMessage(this.t("plugins.generic.codecheck.validation.manifestRequired"),"error"),!1):this.metadata.codecheckers.length===0?(this.showMessage(this.t("plugins.generic.codecheck.validation.codecheckersRequired"),"error"),!1):this.metadata.certificate?this.metadata.summary?!0:(this.showMessage(this.t("plugins.generic.codecheck.validation.summaryRequired"),"error"),!1):(this.showMessage(this.t("plugins.generic.codecheck.validation.certificateRequired"),"error"),!1)},showMessage(s,o){this.saveMessage=s,this.saveMessageType=o,setTimeout(()=>{this.saveMessage=""},5e3)},formatDateTimeLocal(s){const o=new Date(s),n=o.getFullYear(),c=String(o.getMonth()+1).padStart(2,"0"),t=String(o.getDate()).padStart(2,"0"),a=String(o.getHours()).padStart(2,"0"),i=String(o.getMinutes()).padStart(2,"0");return n+"-"+c+"-"+t+"T"+a+":"+i}}},ee={class:"codecheck-metadata-form"},te={key:0,class:"loading-state"},oe={key:1,class:"error-state"},ie={key:2},ce={class:"codecheck-header"},se={class:"header-content"},ne={class:"version-selector"},ae={class:"version-label"},re={class:"publication-section"},le={class:"radio-options"},de={class:"radio-option"},pe={class:"radio-label"},me={class:"radio-option"},he={class:"radio-label"},ke={class:"form-section read-only-section"},fe={class:"section-title"},ue={class:"info-grid"},ge={class:"info-item"},ye={class:"info-label"},be={class:"info-value"},_e={class:"info-item"},Ee={class:"info-label"},Ve={class:"info-value"},Ne={key:0,class:"orcid-badge"},we={key:1},De={key:0,class:"info-item"},Be={class:"info-label"},Se={class:"info-value"},Ce=["href"],Me={key:1,class:"info-item"},Te={class:"info-label"},Ue={class:"info-value"},Fe=["href"],Ie={key:2,class:"info-item"},xe={class:"info-label"},Re={class:"info-value"},Le=["href"],Oe={key:3,class:"info-item"},Ae={class:"info-label"},Pe={class:"info-value"},je={class:"manifest-preview"},qe={class:"form-section form-details"},ze={class:"section-title"},He={class:"section-description"},Ye={class:"field-group"},We={class:"field-header"},Ke={class:"field-label"},Xe={class:"field-description"},Je={key:0,class:"pkpTable manifest-table"},Ge=["onUpdate:modelValue"],Qe={class:"file-info"},Ze=["onClick","title"],$e={key:1,class:"file-name"},ve={key:2,class:"file-size"},et=["onUpdate:modelValue","placeholder"],tt=["onClick"],ot={key:1,class:"empty-state"},it={class:"field-group"},ct={class:"field-header"},st={class:"field-label"},nt={class:"field-description"},at={key:0,class:"repository-list"},rt=["onUpdate:modelValue","placeholder"],lt=["onClick"],dt={key:1,class:"empty-state"},pt={class:"field-group"},mt={class:"field-header"},ht={class:"field-label"},kt={key:0,class:"items-list codecheckers-list"},ft={class:"item-content"},ut={class:"item-name"},gt={key:0,class:"item-orcid"},yt=["onClick"],bt={key:1,class:"empty-state"},_t={class:"field-group"},Et={class:"field-label"},Vt={class:"field-description"},Nt=["placeholder"],wt={class:"field-group"},Dt={class:"field-label"},Bt={class:"field-description"},St={class:"field-group"},Ct={class:"field-label"},Mt={class:"field-group"},Tt={class:"field-label"},Ut={class:"field-description"},Ft={key:0},It=["href"],xt={class:"certificate-identifier-section"},Rt={class:"certificate-identifier-input-wrapper"},Lt=["placeholder"],Ot=["disabled"],At=["value"],Pt=["disabled"],jt=["value"],qt={class:"identifier-actions",id:"certificate-identifier-button-wrapper"},zt=["disabled"],Ht={class:"form-footer"},Yt={class:"footer-actions"},Wt=["disabled"],Kt=["disabled"];function Xt(s,o,n,c,t,a){return e.openBlock(),e.createElementBlock("div",ee,[t.loading?(e.openBlock(),e.createElementBlock("div",te,[o[18]||(o[18]=e.createElementVNode("span",{class:"pkpSpinner"},null,-1)),e.createElementVNode("p",null,e.toDisplayString(c.t("common.loading")),1)])):t.error?(e.openBlock(),e.createElementBlock("div",oe,[e.createElementVNode("p",null,e.toDisplayString(t.error),1),e.createElementVNode("button",{class:"pkpButton",onClick:o[0]||(o[0]=(...i)=>a.loadData&&a.loadData(...i))},e.toDisplayString(c.t("common.retry")),1)])):t.dataLoaded?(e.openBlock(),e.createElementBlock("div",ie,[e.createElementVNode("div",ce,[e.createElementVNode("div",se,[e.createElementVNode("div",ne,[e.createElementVNode("label",ae,e.toDisplayString(c.t("plugins.generic.codecheck.configVersion")),1),e.withDirectives(e.createElementVNode("select",{"onUpdate:modelValue":o[1]||(o[1]=i=>t.metadata.configVersion=i),class:"version-select"},[...o[19]||(o[19]=[e.createElementVNode("option",{value:"latest"},"latest",-1),e.createElementVNode("option",{value:"1.0"},"1.0",-1)])],512),[[e.vModelSelect,t.metadata.configVersion]])])])]),e.createElementVNode("div",re,[e.createElementVNode("div",le,[e.createElementVNode("label",de,[e.withDirectives(e.createElementVNode("input",{type:"radio","onUpdate:modelValue":o[2]||(o[2]=i=>t.metadata.publicationType=i),value:"doi",name:"publication-type"},null,512),[[e.vModelRadio,t.metadata.publicationType]]),e.createElementVNode("span",pe,e.toDisplayString(c.t("plugins.generic.codecheck.publishWithDOI")),1)]),e.createElementVNode("label",me,[e.withDirectives(e.createElementVNode("input",{type:"radio","onUpdate:modelValue":o[3]||(o[3]=i=>t.metadata.publicationType=i),value:"separate",name:"publication-type"},null,512),[[e.vModelRadio,t.metadata.publicationType]]),e.createElementVNode("span",he,e.toDisplayString(c.t("plugins.generic.codecheck.publishSeparate")),1)])])]),e.createElementVNode("div",ke,[e.createElementVNode("h3",fe,e.toDisplayString(c.t("plugins.generic.codecheck.paperMetadata.title")),1),e.createElementVNode("div",ue,[e.createElementVNode("div",ge,[e.createElementVNode("label",ye,e.toDisplayString(c.t("common.title"))+":",1),e.createElementVNode("div",be,e.toDisplayString(t.submissionData.title||c.t("common.notAvailable")),1)]),e.createElementVNode("div",_e,[e.createElementVNode("label",Ee,e.toDisplayString(c.t("plugins.generic.codecheck.paperMetadata.authors"))+":",1),e.createElementVNode("div",Ve,[t.submissionData.authors&&t.submissionData.authors.length>0?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(t.submissionData.authors,(i,r)=>(e.openBlock(),e.createElementBlock("div",{key:"author-"+r,class:"author-item"},[e.createTextVNode(e.toDisplayString(i.name||c.t("common.unknown"))+" ",1),i.orcid?(e.openBlock(),e.createElementBlock("span",Ne,e.toDisplayString(i.orcid),1)):e.createCommentVNode("",!0)]))),128)):(e.openBlock(),e.createElementBlock("em",we,e.toDisplayString(c.t("plugins.generic.codecheck.paperMetadata.noAuthors")),1))])]),t.submissionData.doi?(e.openBlock(),e.createElementBlock("div",De,[e.createElementVNode("label",Be,e.toDisplayString(c.t("metadata.property.displayName.doi"))+":",1),e.createElementVNode("div",Se,[e.createElementVNode("a",{href:"https://doi.org/"+t.submissionData.doi,target:"_blank"},e.toDisplayString(t.submissionData.doi),9,Ce)])])):e.createCommentVNode("",!0),t.submissionData.codeRepository?(e.openBlock(),e.createElementBlock("div",Me,[e.createElementVNode("label",Te,e.toDisplayString(c.t("plugins.generic.codecheck.codeRepository"))+":",1),e.createElementVNode("div",Ue,[e.createElementVNode("a",{href:t.submissionData.codeRepository,target:"_blank"},e.toDisplayString(t.submissionData.codeRepository),9,Fe)])])):e.createCommentVNode("",!0),t.submissionData.dataRepository?(e.openBlock(),e.createElementBlock("div",Ie,[e.createElementVNode("label",xe,e.toDisplayString(c.t("plugins.generic.codecheck.dataRepository"))+":",1),e.createElementVNode("div",Re,[e.createElementVNode("a",{href:t.submissionData.dataRepository,target:"_blank"},e.toDisplayString(t.submissionData.dataRepository),9,Le)])])):e.createCommentVNode("",!0),t.submissionData.manifestFiles?(e.openBlock(),e.createElementBlock("div",Oe,[e.createElementVNode("label",Ae,e.toDisplayString(c.t("plugins.generic.codecheck.manifestFiles.label"))+":",1),e.createElementVNode("div",Pe,[e.createElementVNode("pre",je,e.toDisplayString(t.submissionData.manifestFiles),1)])])):e.createCommentVNode("",!0)])]),e.createElementVNode("div",qe,[e.createElementVNode("h3",ze,e.toDisplayString(c.t("plugins.generic.codecheck.details.title")),1),e.createElementVNode("p",He,e.toDisplayString(c.t("plugins.generic.codecheck.workflow.description")),1),e.createElementVNode("div",Ye,[e.createElementVNode("div",We,[e.createElementVNode("label",Ke,[e.createTextVNode(e.toDisplayString(c.t("plugins.generic.codecheck.manifest.title"))+" ",1),o[20]||(o[20]=e.createElementVNode("span",{class:"required"},"*",-1))]),e.createElementVNode("button",{type:"button",class:"pkpButton btn-add",onClick:o[4]||(o[4]=(...i)=>a.triggerFileUpload&&a.triggerFileUpload(...i))},e.toDisplayString(c.t("plugins.generic.codecheck.manifestFiles.addFile")),1),e.createElementVNode("input",{type:"file",ref:"fileInput",onChange:o[5]||(o[5]=(...i)=>a.handleFileUpload&&a.handleFileUpload(...i)),multiple:"",style:{position:"absolute",left:"-9999px",opacity:"0"},accept:".pdf,.csv,.txt,.yml,.yaml,.json,.zip,.png,.jpg"},null,544)]),e.createElementVNode("p",Xe,e.toDisplayString(c.t("plugins.generic.codecheck.manifest.subtitle")),1),t.metadata.manifest&&t.metadata.manifest.length>0?(e.openBlock(),e.createElementBlock("table",Je,[e.createElementVNode("thead",null,[e.createElementVNode("tr",null,[o[21]||(o[21]=e.createElementVNode("th",{width:"20"},null,-1)),e.createElementVNode("th",null,e.toDisplayString(c.t("plugins.generic.codecheck.manifest.outputFile")),1),e.createElementVNode("th",null,e.toDisplayString(c.t("plugins.generic.codecheck.manifest.description")),1),o[22]||(o[22]=e.createElementVNode("th",{width:"80"},null,-1))])]),e.createElementVNode("tbody",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.metadata.manifest,(i,r)=>(e.openBlock(),e.createElementBlock("tr",{key:"manifest-"+r,class:"manifest-row"},[e.createElementVNode("td",null,[e.withDirectives(e.createElementVNode("input",{type:"checkbox","onUpdate:modelValue":l=>i.checked=l,class:"file-checkbox"},null,8,Ge),[[e.vModelCheckbox,i.checked]])]),e.createElementVNode("td",null,[e.createElementVNode("div",Qe,[i.filePath?(e.openBlock(),e.createElementBlock("a",{key:0,href:"#",onClick:e.withModifiers(l=>a.downloadFile(i.filePath,i.file),["prevent"]),class:"file-name file-link",title:c.t("plugins.generic.codecheck.downloadFile")},e.toDisplayString(i.file),9,Ze)):(e.openBlock(),e.createElementBlock("span",$e,e.toDisplayString(i.file),1)),i.size?(e.openBlock(),e.createElementBlock("span",ve,"("+e.toDisplayString(a.formatFileSize(i.size))+")",1)):e.createCommentVNode("",!0)])]),e.createElementVNode("td",null,[e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":l=>i.comment=l,class:"pkpFormField__input",placeholder:c.t("plugins.generic.codecheck.manifestFiles.commentPlaceholder")},null,8,et),[[e.vModelText,i.comment]])]),e.createElementVNode("td",null,[e.createElementVNode("button",{type:"button",class:"pkpButton codecheck-btn pkpButton--close",onClick:l=>a.removeManifestFile(r)},"Ã—",8,tt)])]))),128))])])):(e.openBlock(),e.createElementBlock("div",ot,e.toDisplayString(c.t("plugins.generic.codecheck.manifest.emptyState")),1))]),e.createElementVNode("div",it,[e.createElementVNode("div",ct,[e.createElementVNode("label",st,e.toDisplayString(c.t("plugins.generic.codecheck.repositories.title")),1),e.createElementVNode("button",{type:"button",class:"pkpButton btn-add",onClick:o[6]||(o[6]=(...i)=>a.addRepository&&a.addRepository(...i))},e.toDisplayString(c.t("plugins.generic.codecheck.repositories.add")),1)]),e.createElementVNode("p",nt,e.toDisplayString(c.t("plugins.generic.codecheck.repositories.description")),1),t.repositories.length>0?(e.openBlock(),e.createElementBlock("div",at,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.repositories,(i,r)=>(e.openBlock(),e.createElementBlock("div",{key:"repo-"+r,class:"repository-item"},[e.withDirectives(e.createElementVNode("input",{type:"url","onUpdate:modelValue":l=>t.repositories[r]=l,class:"pkpFormField__input",placeholder:c.t("plugins.generic.codecheck.repository.placeholder")},null,8,rt),[[e.vModelText,t.repositories[r]]]),e.createElementVNode("button",{type:"button",class:"pkpButton codecheck-btn pkpButton--close",onClick:l=>a.removeRepository(r)},"Ã—",8,lt)]))),128))])):(e.openBlock(),e.createElementBlock("div",dt,e.toDisplayString(c.t("plugins.generic.codecheck.repositories.emptyState")),1))]),e.createElementVNode("div",pt,[e.createElementVNode("div",mt,[e.createElementVNode("label",ht,[e.createTextVNode(e.toDisplayString(c.t("plugins.generic.codecheck.codecheckers.title"))+" ",1),o[23]||(o[23]=e.createElementVNode("span",{class:"required"},"*",-1))]),e.createElementVNode("button",{type:"button",class:"pkpButton btn-add",onClick:o[7]||(o[7]=(...i)=>a.showCodecheckerModal&&a.showCodecheckerModal(...i))},e.toDisplayString(c.t("plugins.generic.codecheck.codecheckers.add")),1)]),t.metadata.codecheckers&&t.metadata.codecheckers.length>0?(e.openBlock(),e.createElementBlock("div",kt,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.metadata.codecheckers,(i,r)=>(e.openBlock(),e.createElementBlock("div",{key:"checker-"+r,class:"list-item"},[e.createElementVNode("div",ft,[e.createElementVNode("div",ut,e.toDisplayString(i.name),1),i.orcid?(e.openBlock(),e.createElementBlock("div",gt,"ORCID: "+e.toDisplayString(i.orcid),1)):e.createCommentVNode("",!0)]),e.createElementVNode("button",{type:"button",class:"pkpButton codecheck-btn pkpButton--close",onClick:l=>a.removeCodechecker(r)},"Ã—",8,yt)]))),128))])):(e.openBlock(),e.createElementBlock("div",bt,e.toDisplayString(c.t("plugins.generic.codecheck.codecheckers.emptyState")),1))]),e.createElementVNode("div",_t,[e.createElementVNode("label",Et,[e.createTextVNode(e.toDisplayString(c.t("plugins.generic.codecheck.certificate.summary"))+" ",1),o[24]||(o[24]=e.createElementVNode("span",{class:"required"},"*",-1))]),e.createElementVNode("p",Vt,e.toDisplayString(c.t("plugins.generic.codecheck.certificate.summaryDescription")),1),e.withDirectives(e.createElementVNode("textarea",{"onUpdate:modelValue":o[8]||(o[8]=i=>t.metadata.summary=i),class:"pkpFormField__input pkpFormField__input--textarea full-width",rows:"6",placeholder:c.t("plugins.generic.codecheck.certificate.summaryPlaceholder")},null,8,Nt),[[e.vModelText,t.metadata.summary]])]),e.createElementVNode("div",wt,[e.createElementVNode("label",Dt,e.toDisplayString(c.t("plugins.generic.codecheck.certificate.reportUrl")),1),e.createElementVNode("p",Bt,e.toDisplayString(c.t("plugins.generic.codecheck.certificate.reportUrlDescription")),1),e.withDirectives(e.createElementVNode("input",{type:"url","onUpdate:modelValue":o[9]||(o[9]=i=>t.metadata.reportUrl=i),class:"pkpFormField__input full-width",placeholder:"https://zenodo.org/record/12345"},null,512),[[e.vModelText,t.metadata.reportUrl]])]),e.createElementVNode("div",St,[e.createElementVNode("label",Ct,e.toDisplayString(c.t("plugins.generic.codecheck.completionTime.label")),1),e.withDirectives(e.createElementVNode("input",{type:"datetime-local","onUpdate:modelValue":o[10]||(o[10]=i=>t.metadata.checkTime=i),class:"pkpFormField__input full-width"},null,512),[[e.vModelText,t.metadata.checkTime]])]),e.createElementVNode("div",Mt,[e.createElementVNode("label",Tt,[e.createTextVNode(e.toDisplayString(c.t("plugins.generic.codecheck.identifier.title"))+" ",1),o[25]||(o[25]=e.createElementVNode("span",{class:"required"},"*",-1))]),e.createElementVNode("p",Ut,[e.createTextVNode(e.toDisplayString(c.t("plugins.generic.codecheck.identifier.description"))+" ",1),t.certificateIdentifier.issueUrl?(e.openBlock(),e.createElementBlock("span",Ft," - ")):e.createCommentVNode("",!0),t.certificateIdentifier.issueUrl?(e.openBlock(),e.createElementBlock("a",{key:1,href:t.certificateIdentifier.issueUrl,target:"_blank"}," View GitHub Issue ",8,It)):e.createCommentVNode("",!0)]),e.createElementVNode("div",xt,[e.createElementVNode("div",Rt,[e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":o[11]||(o[11]=i=>t.metadata.certificate=i),placeholder:c.t("plugins.generic.codecheck.identifier.label"),class:"certificate-identifier-input",readonly:""},null,8,Lt),[[e.vModelText,t.metadata.certificate]]),e.withDirectives(e.createElementVNode("select",{"onUpdate:modelValue":o[12]||(o[12]=i=>t.certificateIdentifier.venueType=i),class:"certificate-identifier-select certificate-identifier-venue-types",disabled:a.isIdentifierReserved},[o[26]||(o[26]=e.createElementVNode("option",{disabled:"",value:"default",selected:""},"Venue Type",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.certificateIdentifier.venueTypes,i=>(e.openBlock(),e.createElementBlock("option",{key:i,value:i},e.toDisplayString(i),9,At))),128))],8,Ot),[[e.vModelSelect,t.certificateIdentifier.venueType]]),e.withDirectives(e.createElementVNode("select",{"onUpdate:modelValue":o[13]||(o[13]=i=>t.certificateIdentifier.venueName=i),class:"certificate-identifier-select certificate-identifier-venue-names",disabled:a.isIdentifierReserved},[o[27]||(o[27]=e.createElementVNode("option",{disabled:"",value:"default",selected:""},"Venue Name",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.certificateIdentifier.venueNames,i=>(e.openBlock(),e.createElementBlock("option",{key:i,value:i},e.toDisplayString(i),9,jt))),128))],8,Pt),[[e.vModelSelect,t.certificateIdentifier.venueName]])]),e.createElementVNode("div",qt,[e.createElementVNode("button",{type:"button",class:e.normalizeClass(["pkpButton codecheck-btn certificate-identifier-button",a.isIdentifierReserved?"bg-gray":""]),disabled:a.isIdentifierReserved,onClick:o[14]||(o[14]=(...i)=>a.reserveIdentifier&&a.reserveIdentifier(...i))},e.toDisplayString(c.t("plugins.generic.codecheck.identifier.reserve")),11,zt),e.createElementVNode("button",{type:"button",class:"pkpButton codecheck-btn pkpButton--isWarnable codecheck-btn-warning certificate-identifier-button",onClick:o[15]||(o[15]=(...i)=>a.showRemoveIdentifierModal&&a.showRemoveIdentifierModal(...i))},e.toDisplayString(c.t("plugins.generic.codecheck.identifier.remove")),1)])])])]),e.createElementVNode("div",Ht,[e.createElementVNode("div",Yt,[e.createElementVNode("button",{type:"button",class:"pkpButton codecheck-btn",onClick:o[16]||(o[16]=(...i)=>a.previewYaml&&a.previewYaml(...i)),disabled:!a.canPreview},e.toDisplayString(c.t("plugins.generic.codecheck.previewYaml")),9,Wt),e.createElementVNode("button",{type:"button",class:"pkpButton codecheck-btn pkpButton--isPrimary",onClick:o[17]||(o[17]=(...i)=>a.saveMetadata&&a.saveMetadata(...i)),disabled:t.saving},e.toDisplayString(t.saving?c.t("common.saving"):c.t("common.save")),9,Kt)]),t.saveMessage?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["save-message",t.saveMessageType])},e.toDisplayString(t.saveMessage),3)):e.createCommentVNode("",!0)])])):e.createCommentVNode("",!0)])}const V=b(v,[["render",Xt]]),Jt={name:"CodecheckMetadataFormWrapper",props:{submission:{type:Object,required:!0},canEdit:{type:Boolean,default:!0}},mounted(){const s=this.$el;e.createApp(V,{submission:this.submission,canEdit:this.canEdit}).mount(s)}},Gt={id:"codecheck-metadata-container"};function Qt(s,o,n,c,t,a){return e.openBlock(),e.createElementBlock("div",Gt)}const Zt=b(Jt,[["render",Qt]]),$t={class:"certificate-identifier-section"},vt={class:"certificate-identifier-input-wrapper"},eo=["disabled"],to=["value"],oo=["disabled"],io=["value"],co={key:0,class:"certificate-identifier-link-wrapper"},so=["href"],no={class:"certificate-identifier-button-wrapper"},ao=["disabled"],ro=b({__name:"CodecheckCertificateIdentifier",props:{name:String,value:String},emits:["update"],setup(s,{emit:o}){const n=s,c=o,t=e.ref(n.value||""),a=e.ref("default"),i=e.ref("default"),r=e.ref([]),l=e.ref([]),m=e.ref(""),k=e.computed(()=>t.value.trim()!=="");e.onMounted(()=>{f()}),e.watch(t,u=>{c("update",u)});async function f(){let u=pkp.context.apiBaseUrl.replace(/\/api\/v1\/?$/,"");u+="/codecheck_api";try{const p=await(await fetch(`${u}/getVenueData`,{method:"POST",headers:{"Content-Type":"application/json","X-Csrf-Token":pkp.currentUser.csrfToken}})).json();p.success?(console.log("Success:",p.message),r.value=p.venueTypes,l.value=p.venueNames):console.error("Error:",p.error)}catch(h){console.error("Failed to fetch venue data:",h)}}async function d(){if(a.value==="default"||i.value==="default"){alert("Please select both a Venue Type and a Venue Name.");return}let u=pkp.context.apiBaseUrl.replace(/\/api\/v1\/?$/,"");u+="/codecheck_api";try{const p=await(await fetch(`${u}/reserveIdentifier`,{method:"POST",headers:{"Content-Type":"application/json","X-Csrf-Token":pkp.currentUser.csrfToken},body:JSON.stringify({venueType:a.value,venueName:i.value})})).json();p.success?(t.value=p.identifier,m.value=p.issueUrl,alert(`Added new issue with identifier: ${p.identifier}`),console.log("Added new issue with identifier: ",p.identifier,p.issueUrl)):console.error("Error:",p.error)}catch(h){console.error("Request failed:",h)}}function y(){t.value="",m.value=""}return(u,h)=>(e.openBlock(),e.createElementBlock("div",$t,[e.createElementVNode("div",vt,[e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":h[0]||(h[0]=p=>t.value=p),placeholder:"ID - e.g.: 2025-001",class:"certificate-identifier-input",readonly:""},null,512),[[e.vModelText,t.value]]),e.withDirectives(e.createElementVNode("select",{"onUpdate:modelValue":h[1]||(h[1]=p=>a.value=p),class:"certificate-identifier-select certificate-identifier-venue-types",disabled:k.value},[h[3]||(h[3]=e.createElementVNode("option",{disabled:"",value:"default"},"Venue Type",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,p=>(e.openBlock(),e.createElementBlock("option",{key:p,value:p},e.toDisplayString(p),9,to))),128))],8,eo),[[e.vModelSelect,a.value]]),e.withDirectives(e.createElementVNode("select",{"onUpdate:modelValue":h[2]||(h[2]=p=>i.value=p),class:"certificate-identifier-select certificate-identifier-venue-names",disabled:k.value},[h[4]||(h[4]=e.createElementVNode("option",{disabled:"",value:"default"},"Venue Name",-1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value,p=>(e.openBlock(),e.createElementBlock("option",{key:p,value:p},e.toDisplayString(p),9,io))),128))],8,oo),[[e.vModelSelect,i.value]])]),m.value?(e.openBlock(),e.createElementBlock("div",co,[e.createElementVNode("a",{href:m.value,target:"_blank"}," View GitHub Issue ",8,so)])):e.createCommentVNode("",!0),e.createElementVNode("div",no,[e.createElementVNode("button",{type:"button",class:e.normalizeClass(["certificate-identifier-button",k.value?"bg-gray":"bg-blue"]),disabled:k.value,onClick:d}," Reserve Identifier ",10,ao),e.createElementVNode("button",{type:"button",class:"certificate-identifier-button bg-red",onClick:y}," Remove Identifier ")])]))}},[["__scopeId","data-v-07386d77"]]);pkp.registry.registerComponent("CodecheckReviewDisplay",Z),pkp.registry.registerComponent("CodecheckMetadataForm",V),pkp.registry.registerComponent("CodecheckMetadataFormWrapper",Zt),pkp.registry.registerComponent("CodecheckManifestFiles",E),pkp.registry.registerComponent("CodecheckRepositoryList",_),pkp.registry.registerComponent("CodecheckCertificateIdentifier",ro);const{useLocalize:N}=pkp.modules.useLocalize,{t:g}=N();pkp.registry.storeExtend("workflow",s=>{const o=s.store;o.extender.extendFn("getMenuItems",(n,c)=>{const t=c==null?void 0:c.submission;if((t==null?void 0:t.codecheckOptIn)==!0||(t==null?void 0:t.codecheckOptIn)==1||(t==null?void 0:t.codecheckOptIn)==="1"){const i=[...n],r=i.find(l=>l.key==="workflow");if(r&&r.items){const l={key:"codecheck",label:g("plugins.generic.codecheck.workflow.label"),state:{primaryMenuItem:"workflow",title:g("plugins.generic.codecheck.workflow.title"),stageId:999}},m=r.items.findIndex(k=>{var f;return((f=k.state)==null?void 0:f.stageId)===pkp.const.WORKFLOW_STAGE_ID_EXTERNAL_REVIEW});m>=0?r.items.splice(m+1,0,l):r.items.push(l)}return i}return n}),o.extender.extendFn("getPrimaryItems",(n,c)=>{var a,i,r,l;const t=c==null?void 0:c.submission;return((a=c==null?void 0:c.selectedMenuState)==null?void 0:a.primaryMenuItem)==="workflow"&&((i=c==null?void 0:c.selectedMenuState)==null?void 0:i.stageId)===999?[{title:"WORKFLOW: CODECHECK",component:"CodecheckMetadataFormWrapper",props:{submission:t,canEdit:!0}}]:((r=c==null?void 0:c.selectedMenuState)==null?void 0:r.primaryMenuItem)==="workflow"&&((l=c==null?void 0:c.selectedMenuState)==null?void 0:l.stageId)===pkp.const.WORKFLOW_STAGE_ID_EXTERNAL_REVIEW&&(t!=null&&t.codecheckOptIn)?[...n,{component:"CodecheckReviewDisplay",props:{submission:t}}]:n})}),pkp.registry.storeExtend("fileManager_SUBMISSION_FILES",s=>{const o=s.store,n=pkp.registry.getPiniaStore("workflow"),c=n==null?void 0:n.submission;c!=null&&c.codecheckOptIn&&(o.extender.extendFn("getColumns",(t,a)=>{const i=[...t];return i.splice(i.length-1,0,{header:g("plugins.generic.codecheck.codecheckStatus"),component:"CodecheckFileStatus",props:{}}),i}),o.extender.extendFn("getItemActions",(t,a)=>a.file?[...t,{label:g("plugins.generic.codecheck.markAsOutput"),name:"markCodecheckOutput",icon:"CheckCircle",actionFn:({file:i})=>{const{useModal:r}=pkp.modules.useModal,{openDialog:l}=r(),{localize:m}=N();l({title:g("plugins.generic.codecheck.markAsOutputTitle"),message:g("plugins.generic.codecheck.markAsOutputConfirm",{fileName:m(i.name)}),actions:[{label:g("common.yes"),isPrimary:!0,callback:k=>{console.log("Marking file as CODECHECK output:",i),k()}},{label:g("common.no"),callback:k=>{k()}}]})}}]:t))}),window.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{lo()},1e3)});function lo(){var c,t,a;const s=(c=document.querySelector('textarea[name="manifestFiles"]'))==null?void 0:c.parentElement;if(s){const i=s.querySelector("textarea"),r=document.createElement("div");s.insertBefore(r,i),i.style.display="none",e.createApp(E,{name:"manifestFiles",label:"Expected Output Files",description:"List the main figures, tables, and results",value:i.value,isRequired:!0}).mount(r),r.addEventListener("update",l=>{i.value=l.detail,i.dispatchEvent(new Event("input",{bubbles:!0}))})}const o=(t=document.querySelector('textarea[name="codeRepository"]'))==null?void 0:t.parentElement;if(o){const i=o.querySelector("textarea"),r=document.createElement("div");o.insertBefore(r,i),i.style.display="none",e.createApp(_,{name:"codeRepository",label:"Code Repository URL(s)",description:"Link(s) to your code repository(ies)",value:i.value}).mount(r),r.addEventListener("update",l=>{i.value=l.detail,i.dispatchEvent(new Event("input",{bubbles:!0}))})}const n=(a=document.querySelector('textarea[name="dataRepository"]'))==null?void 0:a.parentElement;if(n){const i=n.querySelector("textarea"),r=document.createElement("div");n.insertBefore(r,i),i.style.display="none",e.createApp(_,{name:"dataRepository",label:"Data Repository URL(s)",description:"Link(s) to your data repository(ies)",value:i.value}).mount(r),r.addEventListener("update",l=>{i.value=l.detail,i.dispatchEvent(new Event("input",{bubbles:!0}))})}}const po={template:`
    <pkp-table-cell>
      <span class="codecheck-status" :class="statusClass">{{ statusText }}</span>
    </pkp-table-cell>
  `,props:["file"],computed:{statusText(){return this.file.codecheckOutput?g("plugins.generic.codecheck.status.marked"):g("plugins.generic.codecheck.status.notMarked")},statusClass(){return this.file.codecheckOutput?"status-marked":"status-not-marked"}}};pkp.registry.registerComponent("CodecheckFileStatus",po),console.log("CODECHECK plugin initialized successfully")})(pkp.modules.vue);
